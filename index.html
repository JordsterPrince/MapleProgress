<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Maple Progress</title>
    <!-- Load custom font (optional but thematic) -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <!-- Link to external CSS file -->
  <link rel="stylesheet" href="style.css">

  <!-- Link to Favicons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-HNNL2QKY4L"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-HNNL2QKY4L');
  </script>
</head>
<body>

  <h1>Maple Progress</h1>
  <p class="subtitle">By: KingJordster</p>
  <form id="equipForm">
    <table>
      <thead>
        <tr>
          <th>Equipment Slot</th>
          <th>Item Level</th>
          <th>Flame Score</th>
          <th>Potential %</th>
        </tr>
      </thead>
      <tbody id="equipmentTable">
        <!-- Rows will be injected by JS -->
      </tbody>
    </table>
    <div class="form-controls">
      <label for="sortMode">Sort By:</label>
      <select id="sortMode" name="sortMode">
        <option value="cost">Cost</option>
        <option value="efficiency">Cost Per 5 Score</option>
      </select>
      <button type="submit">Submit</button>
    </div>
    <div id="results"></div>
    <div id="loader" class="spinner hidden"></div>
  </form>

  <script>
    const slots = [
      "Ring 1", "Ring 2", "Ring 3", "Ring 4",
      "Pendant 1", "Pendant 2", "Belt", "Hat",
      "Face", "Eye", "Top", "Bottom", "Shoes",
      "Earring", "Shoulder", "Glove", "Cape",
      "Heart", "Pocket" // ðŸ‘ˆ add Pocket at the end
    ];

    const table = document.getElementById("equipmentTable");

    slots.forEach(slot => {
      const isRingOrShoulderOrHeart = slot.startsWith("Ring") || slot === "Shoulder" || slot === "Heart";
      const isPocket = slot === "Pocket";

      const isAccessory = ["Ring", "Pendant", "Belt", "Face", "Eye", "Earring"].some(type => slot.includes(type));

      const row = document.createElement("tr");

      // Flame Input Cell
      const flameCell = isRingOrShoulderOrHeart
        ? "<em>N/A</em>"
        : `
          <input type="number" name="${slot}_allstat" placeholder="All%" min="0" />
          <input type="number" name="${slot}_attack" placeholder="Atk" min="0" />
          <input type="number" name="${slot}_mainstat" placeholder="Main" min="0" />
          <input type="number" name="${slot}_secondarystat" placeholder="Sec" min="0" />
        `;

      const nonBossCheckbox = isAccessory && !slot.startsWith("Ring")
        ? `<label style="display:block;margin-top:4px;">
            <input type="checkbox" name="${slot}_nonboss" />
            Non Boss Flame
          </label>`
        : "";

      // Potential Cell: skip if Pocket
      const potentialCell = isPocket
        ? "<em>N/A</em>"
        : `<input type="number" name="${slot}_potential" min="0" max="100" />`;

      row.innerHTML = `
        <td>${slot}</td>
        <td><input type="number" name="${slot}_level" min="0" /></td>
        <td>${flameCell}${nonBossCheckbox}</td>
        <td>${potentialCell}</td>
      `;

      table.appendChild(row);
    });

    document.getElementById("equipForm").addEventListener("submit", async function(e) {
      e.preventDefault();

      const loader = document.getElementById("loader");
      loader.classList.remove("hidden"); // âœ… Show spinner
      const formData = new FormData(e.target);
      const data = {};
      data.sortMode = document.getElementById("sortMode").value;

      slots.forEach(slot => {
        const itemLevel = Number(formData.get(`${slot}_level`)) || 0;
        const nonBoss = formData.get(`${slot}_nonboss`) === "on";
        const allStat = Number(formData.get(`${slot}_allstat`)) || 0;
        const attack = Number(formData.get(`${slot}_attack`)) || 0;
        const mainStat = Number(formData.get(`${slot}_mainstat`)) || 0;
        const secondaryStat = Number(formData.get(`${slot}_secondarystat`)) || 0;

        const flameScore = (allStat * 12) + (attack * 3) + mainStat + Math.round(secondaryStat / 12);

        const potential = slot === "Pocket"
          ? 0  // No input now, but leave the field in
          : Number(formData.get(`${slot}_potential`)) || 0;
          
        data[slot] = {
          itemLevel,
          flameScore,
          potential,
          nonBoss
        };
      });

      try {
        const response = await fetch("https://mapleprogress-bbckbxg3cvbmfwck.southcentralus-01.azurewebsites.net/api/calculate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        const resultHtml = await response.text();
        document.getElementById("results").innerHTML = resultHtml;
      } catch (err) {
        console.error("Error fetching results:", err);
        document.getElementById("results").innerHTML = "<p>Something went wrong. Please try again.</p>";
      } finally {
        loader.classList.add("hidden"); // âœ… Always hide spinner
      }
    });
  </script>
  <footer class="footer-notes">
    <h2>Notes</h2>
    <ul>
      <li>Stat Equivalent:
        <ul>
          <li>1 All Stat = 12 Main Stat</li>
          <li>1 Attack = 3 Main Stat</li>
          <li>12 Secondary Stat = 1 Main Stat</li>
        </ul>
      </li>
      <li>Your stat equivalent might be a bit different but shouldnt change the order too much</li>
      <li>Guide doesnt check for ultra low flames example: Under 500mil to obtain</li>
      <li>Guide doesnt check for ultra high flames example: Over 500bil to obtain</li>
      <li>Potential assumes all items are at at least fake 2Line.  You wouldnt be checking the guide to see if you should invest in 1 line stat...</li>
      <li>Potential checks for 3% higher than what you have</li>
      <li>Potential assumes you use Glowing(Red) cubes to full 3Line then Bright(Black) cubes after full 3Line</li>
      <li>Currently does not support CD hats, and Crit dam gloves. Both are VERY IMPORTANT check class discord to see if you need CD Hat.  Everyone should go for Crit Dam in gloves</li>
      <li>Next up to add Weapon Secondary and Emblem then possibly star force</li>
      <li>If you want to donate: <a href="https://venmo.com/u/Jordan-Murray-31" target="_blank">Venmo</a></li>
      <li>Questions? DM me on Discord: <strong>@Jordsterking</strong></li>
    </ul>
  </footer>
</body>
</html>
